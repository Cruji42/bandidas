<!doctype html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Las Bandidas</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- <link rel="manifest" href="site.webmanifest"> -->
    <link rel="shortcut icon" type="image/x-icon" href="img/favicon.png">
    <!-- Place favicon.ico in the root directory -->

    <!-- CSS here -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/themify-icons.css">
    <link rel="stylesheet" href="css/nice-select.css">
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/animate.css">
    <link rel="stylesheet" href="css/slicknav.css">
    <link rel="stylesheet" href="css/style.css">
    <!-- <link rel="stylesheet" href="css/responsive.css"> -->
</head>

<body>
    <!--[if lte IE 9]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
        <![endif]-->

    <!-- header-start -->
    <header>
        <div class="header-area ">
            <div id="sticky-header" class="main-header-area">
                <div class="container-fluid p-0">
                    <div class="row align-items-center no-gutters">
                        <div class="col-xl-5 col-lg-5">
                            <div class="main-menu  d-none d-lg-block">
                                <nav>
                                    <ul id="navigation">
                                        <li><a class="active" href="index.html">home</a></li>
                                        <li><a href="Menu.html">Menu</a></li>
                                        <li><a href="about.html">Conócenos</a></li>
                                        <!-- <li><a href="#">blog <i class="ti-angle-down"></i></a>
                                            <ul class="submenu">
                                                <li><a href="blog.html">blog</a></li>
                                                <li><a href="single-blog.html">single-blog</a></li>
                                            </ul>
                                        </li> -->
                                        <!-- <li><a href="contact.html">Contact</a></li> -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                        <div class="col-xl-2 col-lg-2">
                            <div class="logo-img">
                                <a href="index.html">
                                    <img width="150px" src="img/logo.png" alt="">
                                </a>
                            </div>
                        </div>
                        <div class="col-xl-5 col-lg-5 d-none d-lg-block">
                            <div class="row book_room">
                                

                                <div class="socail_links col-3 offset-2">
                                    <ul>
                                        <li>
                                            <a href="#">
                                                <i class="fa fa-instagram"></i>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                <i class="fa fa-facebook"></i>
                                            </a>
                                        </li>
                                    </ul>
                                </div>

                                <div class="dropdown  col-6" id="log_button" >
                                   
                                </div>
                                    <!-- <div class="book_btn  d-xl-block" id="log_button">
                                       
                                    </div> -->

                            </div>
                        </div>
                        <div class="col-12">
                            <div class="mobile_menu d-block d-lg-none"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- header-end -->

    <!-- bradcam_area_start -->
    <div class="bradcam_area breadcam_bg">
        <h3>ORDENES</h3>
    </div>
    <!-- bradcam_area_end -->

    <!--================Blog Area =================-->
    <section class="blog_area section-padding">
        <div class="container">
            <div class="row"  id="order">
                
            </div>
            <nav class="blog-pagination justify-content-center d-flex">
                <ul class="pagination">
                    <li class="page-item">
                        <a href="#" class="page-link" aria-label="Previous">
                            <i class="ti-angle-left"></i>
                        </a>
                    </li>
                    <li class="page-item">
                        <a href="#" class="page-link">1</a>
                    </li>
                    <li class="page-item active">
                        <a href="#" class="page-link">2</a>
                    </li>
                    <li class="page-item">
                        <a href="#" class="page-link" aria-label="Next">
                            <i class="ti-angle-right"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </section>

    <div class="modal fade " id="modalShoppingCar" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modalShoppingCar" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Carrito de compras</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                <table class="table">
                     <thead>
                         <tr>
                            <th scope="col">Producto</th>
                            <th scope="col">Cantidad</th>
                            <th scope="col">Observaciones</th>
                            <th scope="col">Precio unitario</th>
                            <th scope="col">Subtotal</th>
                        </tr>
                     </thead>
                     <tbody id="shoppingCarContent">
                     </tbody>
                </table>
                <hr>
                <div class="row">
                    <div class="offset-8 col-2">
                        <b>TOTAL</b>
                    </div>
                    <div id="total" class="col-2">
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
              <button type="button" class="btn btn-danger btn-small" data-dismiss="modal" >Cancelar</button>
              <button type="button" class="btn text-white btn-warning btn-small" onclick="sendOrder()" data-dismiss="modal" >Hacer la Orden</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade " id="modalOrder" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modalShoppingCar" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="LabelOrder">Orden </h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
                <table class="table">
                     <thead>
                         <tr>
                            <th scope="col">Producto</th>
                            <th scope="col">Cantidad</th>
                            <th scope="col">Observaciones</th>
                            <th scope="col">Precio unitario</th>
                            <th scope="col">Subtotal</th>
                        </tr>
                     </thead>
                     <tbody id="OrderContent">
                     </tbody>
                </table>
                <hr>
                <div class="row">
                    <div class="offset-8 col-2">
                        <b>TOTAL</b>
                    </div>
                    <div id="totalOrder" class="col-2">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn text-white btn-warning btn-small" data-dismiss="modal" >Cerrar</button>
            </div>
          </div>
        </div>
      </div>
    <!--================Blog Area =================-->

    <!-- footer_start  -->
    <footer class="footer">
        <div class="footer_top">
            <div class="container">
                <div class="row">
                    <div class="col-xl-4 col-md-6 col-lg-4">
                        <div class="footer_widget text-center ">
                            <h3 class="footer_title pos_margin">
                                    New York
                            </h3>
                            <p>5th flora, 700/D kings road, <br> 
                                    green lane New York-1782 <br>
                                    <a href="#">info@burger.com</a></p>
                            <a class="number" href="#">+10 378 483 6782</a>

                        </div>
                    </div>
                    <div class="col-xl-4 col-md-6 col-lg-4">
                        <div class="footer_widget text-center ">
                            <h3 class="footer_title pos_margin">
                                California
                            </h3>
                            <p>5th flora, 700/D kings road, <br> 
                                    green lane New York-1782 <br>
                                    <a href="#">info@burger.com</a></p>
                            <a class="number" href="#">+10 378 483 6782</a>

                        </div>
                    </div>
                    <div class="col-xl-4 col-md-12 col-lg-4">
                            <div class="footer_widget">
                                    <h3 class="footer_title">
                                            Stay Connected
                                    </h3>
                                    <form action="#" class="newsletter_form">
                                        <input type="text" placeholder="Enter your mail">
                                        <button type="submit">Sign Up</button>
                                    </form>
                                    <p class="newsletter_text">Stay connect with us to get exclusive offer!</p>
                                </div>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <div class="col-lg-4">
                        <div class="socail_links text-center">
                                <ul>
                                    <li>
                                        <a href="#">
                                            <i class="ti-instagram"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <i class="ti-twitter-alt"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <i class="ti-facebook"></i>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#">
                                            <i class="fa fa-google-plus"></i>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="copy-right_text">
            <div class="container">
                <div class="footer_border"></div>
                <div class="row">
                    <div class="col-xl-12">
                        <p class="copy_right text-center">
                            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- footer_end -->
    

    <!-- JS here -->
    <script src="js/vendor/modernizr-3.5.0.min.js"></script>
    <script src="js/vendor/jquery-1.12.4.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/isotope.pkgd.min.js"></script>
    <script src="js/ajax-form.js"></script>
    <script src="js/waypoints.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <script src="js/imagesloaded.pkgd.min.js"></script>
    <script src="js/scrollIt.js"></script>
    <script src="js/jquery.scrollUp.min.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/nice-select.min.js"></script>
    <script src="js/jquery.slicknav.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="js/plugins.js"></script>

    <!--contact js-->
    <script src="js/contact.js"></script>
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="js/jquery.form.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/mail-script.js"></script>

    <script src="js/main.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    var token = localStorage.getItem('token');
   
    function clearStorage(){
        localStorage.clear();

    }
    function logout(){
            localStorage.removeItem("token");
            location.href="./login.html";
        }
    
    function parseJwt (token) {
        var base64Url = token.split('.')[1];
        var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                         }).join(''));

        return JSON.parse(jsonPayload);
    }

    var div_log = document.getElementById("log_button")
    var content;
    var id_user;

    if(token){
        let data_user = parseJwt(token);
            id_user = data_user.data.id;
            content = ' <a type="button" class="btn btn-primary dropdown-toggle btn-user-menu  "  data-toggle="dropdown">' + data_user.data.name + '</a><div class="dropdown-menu div-user-menu"><button class="dropdown-item " data-toggle="modal" onclick="showDataShoppingCar()" data-target="#modalShoppingCar" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cart-fill" viewBox="0 0 16 16"><path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/></svg>  Carrito</button><button onclick=" location.href=\'./blog.html \'" class="dropdown-item" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-ticket-detailed-fill" viewBox="0 0 16 16"><path d="M0 4.5A1.5 1.5 0 0 1 1.5 3h13A1.5 1.5 0 0 1 16 4.5V6a.5.5 0 0 1-.5.5 1.5 1.5 0 0 0 0 3 .5.5 0 0 1 .5.5v1.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 11.5V10a.5.5 0 0 1 .5-.5 1.5 1.5 0 1 0 0-3A.5.5 0 0 1 0 6V4.5Zm4 1a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7a.5.5 0 0 0-.5.5Zm0 5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7a.5.5 0 0 0-.5.5ZM4 8a1 1 0 0 0 1 1h6a1 1 0 1 0 0-2H5a1 1 0 0 0-1 1Z"/></svg>  Ordenes</button><hr class="div-user-menu-hr"><button onclick="logout()" class="dropdown-item" style="vertical-align: middle;" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-left" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M6 12.5a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v2a.5.5 0 0 1-1 0v-2A1.5 1.5 0 0 1 6.5 2h8A1.5 1.5 0 0 1 16 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-8A1.5 1.5 0 0 1 5 12.5v-2a.5.5 0 0 1 1 0v2z"/><path fill-rule="evenodd" d="M.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L1.707 7.5H10.5a.5.5 0 0 1 0 1H1.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/></svg>  Cerrar sesión</button></div>'
    } else if(token === null || token === undefined) {
        content = '<a type="button" class="btn btn-primary  btn-user-menu" href="./login.html">Inicia sesión</a>';
    }
    
    div_log.insertAdjacentHTML('afterbegin', content);

    var div_order_product = document.getElementById('OrderContent');
    var div_total_order = document.getElementById('totalOrder');

    function getDataOrder(id){
            let html_products_order = "";
            let total_order = 0;
            let html_total_order;
            $("#OrderContent tr").remove();
             $("#totalOrder p").remove();
            $.ajax({
                type: "POST",
                url: "https://bandidas.herokuapp.com/index.php/ORDER",
                data: JSON.stringify({ "id": parseInt(id_user), "id_order": id }),
                contentType: "application/json",
                success: function (result, status) {
                    console.log(result);
                    result.forEach(element =>{
                        let subtotal = parseInt(element.amount) * parseInt(element.price);
                        total_order = total_order + subtotal;
                        html_products_order = html_products_order + '<tr><th scope="row">'+ element.name +'</th><td>'+element.amount +'</td><td>' + element.comment +'</td><td>$ '+element.price+'</td><td>$ '+subtotal+'</td></tr>'
                    })
                    html_total_order = "<p> $ "+ total_order +"</p>";
                    div_order_product.insertAdjacentHTML('afterbegin',html_products_order);
                    div_total_order.insertAdjacentHTML('afterbegin', html_total_order);


                    
                },
                error:function (error,status){
                        console.log(error);
                }
            })

        }

        var html_order = "";
        var div_order = document.getElementById("order")

    $.ajax({
                type: "POST",
                url: "https://bandidas.herokuapp.com/index.php/ORDER",
                data: JSON.stringify({ "id": parseInt(id_user)}),
                contentType: "application/json",
                success: function (result, status) {
                    console.log(result);
                            result.forEach(element => {
                                html_order = html_order + '<div class="col-lg-6 mb-6 mb-lg-0"><article class="blog_item"><div class="blog_details"><div class="row"><div class="col-5">Folio de orden:  <h2 style="color: #FFC312;">'+ element.code +'</h2></div><div class="col-5">Total:<h2 style="color: #FFC312;"> $'+ element.total +'</h2></div></div><ul class="blog-info-link"><li><span href="#" >'+ element.status +'</span></li><li><span href="#">'+ element.creation_date +'</span></li><li><a data-toggle="modal" onclick="getDataOrder(\''+element.code+'\')" data-target="#modalOrder">Ver más</a></li></ul></div></article></div>'
                            });
                             div_order.insertAdjacentHTML('afterbegin',html_order);
                         },
                error: function (error, status) {
                            console.log(error);
                        }
            })

        


        var html_shoppingCard;
        var tboddy_shopping_card = document.getElementById('shoppingCarContent');
        var total_shoppingCard;
        var  html_total_shoppingCard;
        var  div_total_shoppingCard = document.getElementById("total");

        function showDataShoppingCar(){
            html_shoppingCard = ""; 
            html_total_shoppingCard = "";
            total_shoppingCard = 0;
            let data = JSON.parse(localStorage.getItem('shopping_car_'+id_user));
             $("#shoppingCarContent tr").remove();
             $("#total p").remove();
             console.log(data);
                 data.forEach( element => {
                 let subtotal = parseInt(element.amount) * parseInt(element.price);
                 total_shoppingCard = total_shoppingCard + subtotal;
                 
                  html_shoppingCard = html_shoppingCard + '<tr><th><button type="button" class="deleteButton" onclick="deleteProduct('+ element.product_id +')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/></svg></button></th><th scope="row">'+ element.name +'</th><td>'+element.amount +'</td><td>' + element.comments +'</td><td>$ '+element.price+'</td><td>$ '+subtotal+'</td></tr>'
              } )
           
             html_total_shoppingCard = "<p> $ "+ total_shoppingCard +"</p>";
             div_total_shoppingCard.insertAdjacentHTML('afterbegin', html_total_shoppingCard);
             tboddy_shopping_card.insertAdjacentHTML('afterbegin', html_shoppingCard);
            
        }

        function sendOrder(){
            console.log(id_user);
            array_insert_order = {
                user_id: id_user,
                order: JSON.parse(localStorage.getItem('shopping_car_'+id_user))
            }

            console.log(array_insert_order);

            $.ajax({
                type: "POST",
                url: "https://bandidas.herokuapp.com/index.php/ORDER",
                data: JSON.stringify(array_insert_order),
                contentType: "application/json",
                success: function (result, status) {
                            console.log(result);
                             if( result.body === 'success'){
                                 localStorage.removeItem("shopping_car_"+id_user);
                                 Swal.fire({
                                     title: 'Orden realizada',
                                    text: 'Tu orden ha sido realizada con exito',
                                    icon: 'success',
                                    confirmButtonText: 'Aceptar',
                                    confirmButtonColor: '#F2C64D'
                                })
                             } else {
                                Swal.fire({
                                title: 'Error',
                                icon: 'error',
                                text: 'Lo sentimos, no pudimos procesar tu orden, intentalo más tarde',
                                confirmButtonText: 'Aceptar',
                                confirmButtonColor: '#F2C64D'
                                }) 
                             }
                         },
                error: function (error, status) {
                            console.log(error);
                        }
            })
        }

        function deleteProduct(id){

            html_shoppingCard = ""; 
            html_total_shoppingCard = "";
            total_shoppingCard = 0;
            Swal.fire({
                title: 'Eliminar producto',
                text: '¡Realmente deseas eliminar este producto de tu carrito de compras?',
                icon: 'warning',
                confirmButtonText: 'Aceptar',
                confirmButtonColor: '#F2C64D',
                showCancelButton: true,
                cancelButtonText: 'Cancelar',
                cancelButtonColor: '#D73141'
            }).then((res) => {
                if(res.isConfirmed){
                    let data = JSON.parse(localStorage.getItem('shopping_car_'+id_user));
                    data.forEach( (element, index) => {
                        if( parseInt(element.product_id) === id){
                            data.splice(index,1);
                        }
                    })            
                    $("#shoppingCarContent tr").remove();
                    $("#total p").remove();

                    data.forEach( element => {
                        let subtotal = parseInt(element.amount) * parseInt(element.price);
                        total_shoppingCard = total_shoppingCard + subtotal;
                        html_shoppingCard = html_shoppingCard + '<tr><th><button type="button" class="deleteButton" onclick="deleteProduct('+ element.product_id +')"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle-fill" viewBox="0 0 16 16"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"/></svg></button></th><th scope="row">'+ element.name +'</th><td>'+element.amount +'</td><td>' + element.comments +'</td><td>$ '+element.price+'</td><td>$ '+subtotal+'</td></tr>'
                    } )
           
                    html_total_shoppingCard = "<p> $ "+ total_shoppingCard +"</p>";
                    div_total_shoppingCard.insertAdjacentHTML('afterbegin', html_total_shoppingCard);
                    tboddy_shopping_card.insertAdjacentHTML('afterbegin', html_shoppingCard);  
                    localStorage.setItem('shopping_car_'+id_user, JSON.stringify(data));                 
                }
            } )
           
        }

        var info_order = [];


</script>
</body>

